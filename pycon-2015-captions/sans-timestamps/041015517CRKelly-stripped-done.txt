WELCOME TO THE SESSION, SECOND SESSION OF YOUR
PYCON 2015.
WE'RE HERE TODAY WITH RYAN KELLY, A DEVELOPER ON
THE MOZILLA ACCOUNT TEAM, AND HE'S GOING TO BE
TALKING TO US ABOUT PYPY.JS.
>> IF YOU NEED TO CONTACT ME.
THERE WE GO.
AS YOU JUST HEARD, I WORK FOR MOZILLA, AND IF
YOU'VE HEARD OF MOZILLA, IT'S PROBABLY BECAUSE WE
MAKE A PRETTY AWESOME WEB BROWSER, CALLED
FIREFOX, WHICH BY THE WAY I'M USING FOR MY SLIDES
HERE TODAY.
BUT MOZILLA AS A COMPANY AND AS A WORLDWIDE
COMMUNITY OF VOLUNTEERS, WE'RE ABOUT A LOT MORE
THAN JUST, HEY, LET'S MAKE FIREFOX A REALLY
AWESOME WEB BROWSER.
AT ITS CORE, THE THING THAT DRIVES MOZILLA AND
FUNNILY ENOUGH, THE THING THAT DRIVES ALL THE
MATERIAL IN THIS TALK, BELIEVE IT OR NOT, IS OUR
MISSION TO PROTECT AND PROMOTE THE WEB.
ALL RIGHT, THE WEB AS A SHARED GLOBAL TECHNOLOGY
BLATT FORM AND AS A RESOURCE FOR EMPOWERMENT AND
INNOVATION AND OPPORTUNITY.
BUT WHEN I SAY "THE WEB," I'M REALLY KIND OF
TALKING ABOUT TWO BUT DIFFERENT INTERRELATED
THINGS.
AS ENGINEERS, WE TALK ABOUT THE WEB, WE TEND TO
THINK OF THE TECHNOLOGY STACK OF THE WEB, RIGHT?
THINGS LIKE HIGHWAYS HSMP, JAVASCRIPT, BUT FROM A
PRODUCT PERSPECTIVE OR PERHAPS FROM A CULTURAL
PERSPECTIVE, THE WEB ALSO HAS A LOT OF RATHER YOU
NUKE PROPERTIES.
SO ONE OF THE THING PEOPLE TENDS TO LOVE ABOUT
THE WEB, IT'S A REALLY OPEN SYSTEM.
IF YOU WANT TO PUBLISH SOMETHING ON THE WEB, YOU
DON'T SUBMIT IT TO THE WEB STORE AND THEN TWIDDLE
YOUR THUMBS FOR SIX MONTHS WHILE SOMEONE ON THE
OTHER SIDE OF THE WORLD REVIEWS YOUR
COMPATIBILITIES WITH THE WEB STEMS OF SERVICE AND
REJECT YOU ON A TECHNICALITY.
YOU GET A DOMAIN NAME, PUT IT ON THE WEB AND TELL
PEOPLE TO GET IT.
LIKEWISE, IF PEOPLE WANT TO CONSUME YOUR STUFF ON
THE WEB, THEY DON'T NEED A PARTICULAR DEVICE OR
VENDOR OR SOFTWARE, YOU KNOW, IT'S OPEN FOR BOTH
PRODUCERS AND CONSUMERS.
THE WEB ALSO HAS A PRETTY INTERESTING KIND OF
SECURITY STORY.
ALL ABOUT RUNNING UNTRUSTED CODE YOU'VE NEVER
SEEN BEFORE IN A WAY THAT DOESN'T LET PEOPLE HACK
YOU, DOESN'T LET PEOPLE LEARN ABOUT YOUR
INTERACTIONS WITH OTHER SITES AND SO FORTH SO THE
WEB IS PRETTY UNIQUE.
THE PROBLEM IS, I COULD VERY EASILY HAVE LABELED
THESE COLUMNS THUSLY.
ALL RIGHT?
THERE ARE SUBSTANTIAL NUMBER OF PEOPLE, NOT
TERRIBLY FOND OF THE TECHNOLOGY STACK OF THE WEB.
A LOT OF PEOPLE GO SO FAR AS SO WISH THAT THE WEB
WOULD JUST HURRY UP AND DIE SO WE CAN REPLACE
WITNESS SOMETHING BETTER, ALL RIGHT?
BUT THE PROBLEM S YOU CAN'T JUST THROW AWAY THE
TECH STACK OF THE WEB AND KEEP ALL THE GOOD
CULTURAL PROPERTIES OF THE WEB, THE TWO ARE FOR
BETTER OR WORSE INTERTWINED.
SO FOR ALL ITS FLAWS, I FEEL LIKE THE WEB REALLY
IS WORTH KEEPING, AND IF WE'RE GOING TO KEEP IT,
THEN WE SHOULD BE WORKING TO TRY TO MAKE IT
BETTER.
AND OUR CTO, ANDREAS, PUT THIS IN AN INTERESTING
WAY, FOR MOW STILL LARKS ANYTHING THAT THE WEB
CAN'T DO, ANY TIME THE WEB ISN'T FASTER OR BETTER
THAN NATIVE TECHNOLOGY, ANY TIME SOMEONE REACHES
FOR A NATIVE TECHNOLOGY BECAUSE THEY THINK THE
WEB ISN'T UP TO THE CHALLENGE, WE SHOULD THINK OF
THAT AS A BUG.
WE SHOULD FILE IT AND WORK TOWARDS GETTING IT
FIST.
AS A PYTHONNISTA, I HAVE NOTICED ONE OF THESE
BUGS IN THE WEB AND MAYBE YOU'VE NOTICED IT, TOO,
RIGHT?
I WANT TO CODE IN PYTHON AND THAT'S KIND OF HARD
TO DO ON THE WEB RIGHT NOW, WHICH BRINGS ME TO
THE TOPIC OF THIS TALK.
THIS IS MY KIND OF EXPERIMENT IN WHAT'S POSSIBLE
IN BRINGING PYTHON TO THE WEB, A PROJECT CALLED
PYPY.JS.
I WANT TO TELL YOU A LITTLE BIT ABOUT WHAT IT IS,
HOW IT CAME TOGETHER AND WHY ON EARTH I'M WORKING
ON THIS THING.
SO THE WHAT IN A SENSE IS FAIRLY STRAIGHTFORWARD,
THE PYPY, PYTHON INTERPRETER, IMPORTED TO THE
WEB.
AND IN MY HEAD, IN TALK, THIS IS LIKE A TA-DA
SLIDE, LIKE TADA!!
IF I COULD TYPE WITH MY HANDS WEREN'T SHAKING,
PYTHON ON THE WEB, ALL RIGHT?
[ Applause ]
00:44:18>> THANK YOU.
THAT'S VERY GENEROUS.
I FEEL LIKE IN THIS DAY AND AGE, A LOT OF PEOPLE
HAVE SEEN THIS SORT OF THING BEFORE, RIGHT?
THIS IS NOT THE FIRST PROJECT TRYING TO PUT
PYTHON ON THE WEB BY ANY STRETCH OF THE
IMAGINATION.
IT ALMOST CERTAINLY WON'T BE THE LAST.
SO I WANT TO TELL YOU A LITTLE BIT MORE ABOUT WHY
I'M DOING SOMETHING NEW.
AND FOR ME, TO BE ABLE TO SAY THAT THE WEB
SUPPORTS PYTHON IN A MEANINGFUL SENSE, YOU HAVE
TO TICK THREE BOXES WHICH I WANT TO EXPLAIN BY
WAY OF DEMONSTRATION.
AND THE FIRST POINT IS THAT I -- WHEN I SAY I
WANT TO CODE IN PYTHON, I ACTUALLY WANT PYTHON,
RIGHT?
SO IF I HAVE A NUMBER AND I PUT IT TO THE POWER
OF ANOTHER NUMBER, RIGHT, I SHOULD GET A BIG
NUMBER BACK IN RESPONSE.
IF I WERE TO ASK JAVASCRIPT AND ITS NUMBER MODEL
THAT SAME QUESTION, IT WOULD TELL ME THE ANSWER
IS INFINITY.
WHICH IS OFF BY A LITTLE BIT.
IN I WERE IN JAVASCRIPT AND I DID THIS, RIGHT, IT
WOULDN'T GIVE ME AN EXCEPTION DESPITE THE FACT
THAT I ALMOST CERTAINLY DIDN'T WANT THAT, IT
WOULD TELL ME INFINITY, WHICH I ALSO ALMOST
CERTAINLY DON'T WANT BUT WILL PROBABLY GO AHEAD
AND USE.
SO ONE OF THE THINGS I'M REALLY INTERESTED IN IS
GETTING A FULLY COMPATIBLE PYTHON ENVIRONMENT.
AND IT'S NOT JUST THE NUMBERS, RIGHT?
IN PYTHON, WE CAN DO THINGS LIKE THIS.
EQUALS SOME NUMBER, RIGHT, AND WE GET IT IN THE
GLOBAL SCOPE.
WE CAN DO THINGS LIKE GET FRAME AND MUTATE THE
VARIABLES THROUGH THAT.
ALL OF THESE FUN STUFF THAT WE'VE COME TO EXPECT
FROM PYTHON WE SHOULD ALSO EXPECT FROM THE WEB.
THE SECOND POINT I'M REALLY INTERESTED IN
PERFORMANCE, AND THIS ISN'T TO SAY LIKE I WANT TO
DO SUPER FOUR TREND NUMBER CRUNCHING OR ANYTHING
LIKE THAT BUT IF I GO OVER HERE TO MY SYSTEM
PYTHON, RIGHT, AND I HAVE SOME CODE, FOR EXAMPLE,
THIS IS A BENCHMARK THAT'S JUST BY DEFAULT WITH
PYTHON WHICH IS REALLY GOOD FOR DEMONSTRATIONS,
IF I HAVE SOME CODE THAT I CAN RUN IN MY NATIVE
PYTHON ENVIRONMENT, RUNS AT ABOUT 140 PY STONES
PER SECOND, I SHOULD BE ABLE TO GO TO THE WEB, I
SHOULD BE ABLE TO DO THE SAME THING AND I SHOULD
BE ABLE TO RUN WITH COMPARABLE SPEED, RIGHT?
AS IT HAPPENS IN THIS CASE, IT RUNS IT
SIGNIFICANTLY FASTER THAN THE SYSTEM PYTHON.
THAT'S BECAUSE THIS IS PYPY AND PYPY IS AWESOME,
AND IF I DO IT AGAIN, IT WILL GO FASTER.
BUT I WOULD SETTLE FOR COMPARABLE, RIGHT?
THE WEB SHOULDN'T BE BLOCKING ME FROM DOING
THINGS FAST IN PYTHON.
THE THIRD THING I REALLY CARE ABOUT, FOR WANT OF
A BETTER WORD, I'M CALLING WEBBISHNESS.
BUT JUST TO SAY, HAVING A PYTHON CONSULT ON
THE -- CONSOLE ON THE WEB IS FUN BUT I WANT
SOMETHING OFF THE WEB, I DON'T WANT TO TYPE INTO
A PYTHON SAND BOX, I WANT TO BE ABLE TO INTERACT
WITH THE HOST JAVA SCRIPT ENVIRONMENT AND DO
THINGS LIKE EVALUATE JAVASCRIPT AND GET ANSWERS
BACK WHICH ARE NOT PYTHON NUMBERS, THEY'RE WEIRD
DOUBLES.
I WANT TO BE ABLE TO USE ALL OF THE KIND OF
BROWSER AND DOM INTERACTION STUFF.
TA-DA.
AS YOU CAN TELL, I'M VERY SKILLED AT FRONT-END
DEVELOPMENT, I KNOW ALL ABOUT ALERTING, HELLO,
WORLD.
I WANT TO BE ABLE TO USE, FOR EXAMPLE, LINE
PRAYERS THAT ARE WRITTEN IN JAVASCRIPT AND HAVE
THEM OPERATE IN A SENSIBLE WAY.
FOR EXAMPLE, I WANT TO BE ABLE TO JUST J QUERY TO
FIND THIS CONSOLE WINDOW AND I WANT TO BE ABLE TO
SET ITS BACKGROUND COLOR, AGAIN, IF I COULD
TYPE...
TO SOMETHING FUN LIKE CHARTRUESE.
[ Applause ]
IF I WANT TO GET REALLY FANCY, I WANT TO BE ABLE
TO DEFINE LIKE A CALL-BACK FUNCTION, IN PYTHON,
ALL RIGHT?
AND RETURN, SAY, A CRYPTOGRAPHICALLY SECURELY
GENERATED RANDOM NUMBER -- I HOPE THIS IS GOING
TO WORK.
AND PASS THAT INTO JAVASCRIPT.
NOW CAN ANYONE SPOT MY BUG?
OH, URANDOM.
I USUALLY MAKE A HABIT OF PRE-RECORDING THESE
THINGS BUT IT WOULD LOSE SOME OF THE APPEAL.
NO!!
SORRY?
I'M GOING TO USE UP ALL OF MY TIME, BUT A FUN
DEMO SO I'M GOING TO PERSIST.
THERE WE GO.
SOMETHING THAT'S REALLY OF THE WEB IN A
MEANINGFUL SENSE.
NOW, AS A GENERAL RULE, ALL RIGHT, IF AN ENGINEER
IDENTIFIES THREE DESIRABLE PROPERTIES OF A
SYSTEM, THEY ARE ABOUT TO ASK YOU TO PICK TWO OF
THEM.
AND PYTHON ON THE WEB SUFFERS FROM THIS IN A VERY
SERIOUS WAY, RIGHTS?
THERE ARE PROJECTS LIKE SOME OF THESE THAT I'VE
IDENTIFIED HERE THAT WILL GIVE YOU A PYTHON
SYNTAX THAT WILL TRANSLATE IT MORE OR LESS
DIRECTLY INTO JAVASCRIPT, SO YOU GET THINGS LIKE
JAVASCRIPT'S MODEL NUMBER, THEIR OBJECT BEHAVIOR
WHICH RUNS REALLY FAST IN THE BROWSER BUT, YOU
KNOW, ISN'T PYTHON IN A VERY REAL SENSE.
THERE ARE PROJECTS THAT PUT A LOT MORE EFFORT
INTO BEING COMPATIBLE WITH PYTHON BUT THEY PAY
FOR IT BECAUSE THIS STUFF LIKE GENERATORS AND MED
CLASSES AND FRAMES ARE REALLY HARD SO THEY DON'T
RUN AS FAST AS THEY COULD.
AND IF YOU DON'T REALLY CARE ABOUT BEING ON THE
WEB, WELL, YOU CAN JUST RUN C PYTHON OR PYPY, AND
PUT A LITTLE SHELL WINDOW AND SHELL OUT TO IT
FROM YOUR BROWSER.
MY QUESTION IS, CAN WE HIT ALL THREE OF THESE?
AND PYPY.JS IS KIND OF MY EXPERIMENT IN TRYING TO
DO THAT.
PROMISING LITTLE DEMOS ASIDE, I'M GOING TO LEAVE
THAT AS AN OPEN QUESTION FOR NOW AND COME BACK TO
IT BECAUSE I REALLY WANT TO DIVE INTO THE HOW
BECAUSE I THINK IT'S REALLY INTERESTING.
THIS PROJECT IS ESSENTIALLY A COMING TOGETHER OF
TWO EXCITING RELATIVELY NEW TECHNOLOGIES, ONE IN
THE PYTHON WORLD AND ONE IN THE JAVASCRIPT WORLD.
THE FIRST OF THEM IS PYPY.
SO WHO KNOWS ABOUT PYPY?
ALMOST EVERYONE, AWESOME.
PYPY IS FANTASTIC.
IT'S A PYTHON INTERPRETER WRITTEN IN PYTHON.
WHICH SOUNDS LIKE A TERRIBLE IDEA, ACTUALLY TURNS
OUTS TO BE A GREAT IDEA.
BECAUSE THEY HAVE TWO TRICKS FOR MAKING IT RUN
REALLY FAST, RIGHT?
THE FIRST IS THEY RIGHT IT IN A RESTRICTED SUBSET
OF PYTHON, WHICH IF YOU'RE A COMPILER GENIUS OR
TWO AND YOU EXERT A TREMENDOUS FORCE OF WILL IN
YOUR COMPILATION TOOL CHAIN, YOU CAN TRANSLATE
OUR PYTHON INTO C WHICH MEANS YOU CAN COMPILE IT
INTO A NATIVE EXECUTABLE.
THE OTHER FUN THING THEY HAVE IS ADJUSTING TIME
COMPILER, NOT ADJUSTING, ADJUSTING TIME COMPILER
GENERATOR.
THAT MEANS DURING THIS PROCESS FROM PYTHON
INTERPRETER TO PYTHON INTERPRETER FOR C, YOU CAN
KINDS OF TRANSPARENTLY PUTS ADJUSTING TIME
COMPILER IN THERE, SO AT AN EXTREMELY HIGH LEVEL,
ELIMINATING A LOT OF VERY IMPORTANT DETAILS, THE
PYPY KIND OF TOOL CHAIN LOOKS LIKE THIS.
YOU START WITH A PYTHON INTERPRETER WRITTEN IN
PYTHON YOU RUN ITS THROUGH THIS R-PYTHON
COMPILATION TOOL CHAIN TO GET THE C FILES.
YOU COMPILE THE C FILES WITH A NORMAL COMPILER TO
GET A NATIVE PYTHON INTERPRETER.
YOU FEED YOUR PYTHON CODE INTO IT, AND THIS GOES
THROUGH THE JUST IN TIME COMPILER, TRACES WHAT
THE HOT PADS ARE AND EMITS KINDS OF THIS NATIVE
APPROXIMATION OF THE IMPORTANT BITS OF YOUR CODE,
SO YOU WIND UP RUNNING KINDS OF NATIVELY, WHICH
IS WHY PYPY HAS THIS DESERVED REPUTATION FOR
BEING A VERY FAST PYTHON INTERPRETER.
FROM MY PERSPECTIVE, THE INTERESTING THING ABOUT
PYPY IS THAT IT'S TARGETED AS A PLATFORM FOR
EXPERIMENTATION, BECAUSE IT'S WRITTEN IN PYTHON,
YOU KNOW, IT'S RELATIVELY APPROACHABLE, I WON'T
SAY EASY BUT AN APPROACHABLE PROBLEM TO KIND OF
GO AND BUT A DIFFERENT GARBAGE COLLECTOR IN THERE
OR BUT A DIFFERENT JIT BACK IN THERE, THINGS LIKE
THAT.
THE SECOND PROJECT I WANTED TO TALK ABOUT IS
ENSCRIPTIN.
WHO'S HEARD OF THAT?
ALMOST EVERYONE,.
THAT'S A BACK ENDS ARE FOR THE LLVM COMPILER TOOL
CHAIN BUT INSTEAD OF GENERATING LIKE X86 OR
NATIVE CODE, IT GENERATES JAVASCRIPT WHICH AGAIN
SOUNDS LIKE A TERRIBLE IDEA.
BUT ACTUALLY WORKS OUT REALLY WELL IN PRACTICE.
IN ADDITION TO THIS, IT'S ALSO BASICALLY A LITTLE
SIMULATED SAND BOX ENVIRONMENT FOR THE WEB SO HAS
SIS.H, STUBBED OUT DEVICES AND GET TIME OF DAY
AND ALL THIS STUFF IN A LITTLE SAND BOX ON THE
WEB, AND THE GUY THAT STARTED THIS, A GUY NAMED
ALONZO KAYE, WHEN I MET HIM AND HAD THE
OPPORTUNITY TO ASK HIM ABOUT THE INSPIRATION FOR
IT, HIS EXPLANATION FOR THIS WHOLE ELABORATE
PROJECT WAS BASICALLY, LOOK, I WAS WORKING ON
THIS GAME AND IT WAS IN C PLUS PLUS, AND I WANT
TO RUN IT ON THE WEB.
AND I SAID, OKAY.
I SALUTE YOU IN YOUR CRAZY COMPILER GENIUS WAYS.
IN THE PROCESS OF TRYING TO PUT THIS THING ON THE
WEB, CPLUSPLUS, HE DISCOVERED THAT INSIDE OF I
CAN'T HAVE ASCRIPT, THERE IS A WEIRD MIX OF
HIGH-LEVEL AND LOW-LEVEL FEATURES LIKE CLOSURES
THAT HAVE REALLY GOOD KIND OF NAME REFERENCE
PROTECTION, AND 32-BIT BITWISE OPERATESSORS, BITS
AND PIECES LIKE THIS.
IT TURNS OUT IF YOU KIND OF CARVE OUT A STRANGE
LITTLE BOUNDARY AROUND A LOT OF THE PARTS OF
JAVASCRIPT AND JUST USE THIS ONE LITTLE SUBSET,
WHAT YOU HAVE IS A 32 BIT ASSEMBLY LANGUAGE IN
DISGUISE.
AND SO THE INSCRIPTIN PROJECT BASICALLY TARGETS
THIS SUBSET.
THE WAY IT WORKS IS AS FOLLOWS.
YOU START WITH SOME CODE RIN IN C OR WHATEVER
LANGUAGE YOU CAN TARGET LLVM IN.
IT LOOKS -- A WRAP-AROUND LLVM TOOL CHAIN AND
SPITS OUT JAVA SCRIPTS.
YOU PUTS THAT IN YOUR BROWSER AND BROWSERS HAVE,
YOU KNOW, REALLY POWERFUL JIT COMPILERS IN
THEMSELVES SO THE BROWSER WILL TAKE THAT CODES
AND TURN IT INTO A NATIVE APPROXIMATION OF THE
IMPORTANT PARTS OF THAT CODE.
SO YOU WIND UP IN THE SAME PLACE YOU WOULD HAVE
IF YOU WERE YOURSING SOMETHING LIKE GCC, BUT YOU
KIND OF INDIRECTING THROUGH JAVASCRIPT IN THE
BROWSER.
NOW, THERE'S ONE OBVIOUS THING TO DO FROM THIS
POINT, RIGHT?
AND THAT'S TO TAKE THESE TWO PROJECT AND SMOOSH
THEM TOGETHER.
WHAT COULD POSSIBLY GO WRONG?
SO IT LOOKS LIKE THIS, RIGHT?
YOU HAVE THIS PYTHON INTERPRETER THAT'S WRITTEN
IN PYTHON, YOU RUN IT THROUGH THE R-PYTHON TOOL
CHAIN TO GET A BUNCH OF C FILINGS, YOU YOU KNOW
THROUGH THOSE INSCRIPT TIN, YOU GIVE IT TO YOUR
BROWSER.
I CAN FEED PYTHON INTO THAT CODES AND BECAUSE I
STARTED WITH AN INTERPRETER WRITTEN IN PYTHON,
NOT THAT BIG A DEAL TO CHANGE ITS JIT TO EMIT
JAVASCRIPT AT RUN TIME FOR THE POSITIVE CODE,
WHICH THE BROWSER WILL JIT BACK INTO NATIVE CODE.
SO YOU GET TO WHERE YOU WANTED TO BE BUT GOING
THROUGH THE BROWSER, WHICH IS LOVELY.
NOW, YOU STARTED TO CLAP THEN BUT COME ON, BE
HONEST, WHO'S FIRST THOUGHT UPON SEEING THIS
DIAGRAM WAS APPROXIMATELY THAT IS AWFUL?
[ Laughter ]
THAT'S FINE, THAT'S FINE.
I THINK THAT'S FAIR BUT I DO WANTS YOU TO
CONSIDER THIS, RIGHT?
I'VE BEEN CALLING THIS FINAL THING NATIVE CODE.
BUT IT REALLY AIN'T THESE DAYS.
RIGHT?
WHEN THAT CODE HITS THE CPU, THE CPU IS GOING TO
TRANSLATE THAT INTO ITS OWN INTERNAL
REPRESENTATION OF LIKE MARKER OPERATIONS AND DO
LIKE VIRTUAL REGISTER ALLOCATION AND TRY TO
PREDICTS WHICH BRANCHES YOUR CODES IS GOING TO
TAKE AND SPECK LaACTIVELY EXECUTE THEM AND
STITCH THEM BACK TOGETHER IF IT DOESN'T WORK OUT
PROPERLY, RIGHT?
YOU KNOW, THIS IS NOT JUST, WELL, HERE'S NATIVE
CODE AND IT RUNS IN THE SILICON.
SO, YES, THIS IS KIND OF AN AWFUL COLLECTION OF
WEIRD BACKWARDS COMPATIBILITY HACKS AND LAYERING
VIOLATIONS, BUT THE LAST 30 YEARS OF MODERN
COMPUTING ARE BUILT ON EXACTLY THIS KIND OF WEIRD
BACKWARDS COMPATIBILITY...
[ Applause ]
>> IT'S AWFUL ALL THE WAY DOWN TO THE SILICON.
SO THE QUESTION IS NOT LIKE IS THIS A NICE
ANYONE?
OF COURSE IT'S NOT THE SYSTEM WE WOULD BUILD IF
WE WERE DESIGNING AN ELEGANT CATHEDRAL FROM
SCRATCH.
THE QUESTION IS, IS IT WORTH IT?
NOW, AS MOZILLANS, WE HAVE SOMETHING OF A HABIT
OF PUBLICLY TRACKING OUR PERFORMANCE BENCHMARKS,
SO WHEN THE JAVASCRIPT PERFORMANCE WORDS WARS
WERE HEATING UP, LIKE THE TEAM THAT MOZILLA
CYCLED, FASTNETS.COM WHERE YOU COULD TRACK
PERFORMANCE METRICS.
WAY BACK WHEN FIREFOX WAS A LITTLE BITS OF A
MEMORY HOG, LET'S BE HONEST, THE TEAM WORKING ON
THAT MADE THE CYCLE, ARE WE SLIM YET.COM WHERE
YOU COULD TRACK THE PERFORMANCE?
SO I'VE BEEN WORKING ON THIS CYCLE, ARE WE PYTHON
YET.COM, WHICH DOESN'T FIT ON MY SLIDES, WHERE
YOU CAN GO AND CHECK OUT OUR KIND OF PERFORMANCE
BENCHMARKS.
ZOOM OUT OF THAT SO WE CAN SEE WHAT'S GOING ON.
SO WE HAVE SOME PERFORMANCE TRACKING BENCHMARKS,
SOME START-UP OVERHEAD BENCHMARKS.
LETS ME GIVE YOU THE KINDS OF HIGHLIGHTS.
FIRST THE GOOD BITS.
THIS IS OUR PERFORMANCE TRACKING.
THIS IS PERFORMANCE OF PYPY IN THE BROWSER,
NORMALIZED TO A NATIVE C-PYTHON INTERPRETER.
ACROSS BOTH FIREFOX AND CHROME AND YOU CAN SEE
DOWN AT THE BOTTOM HERE, THIS IS ABOUT 1.4 TIMES
SLOWER THAN NATIVE, WHICH IS NOT TOO BAD.
IF I TAKE CHROME OUT OF THE MIX, HAPPY TO REPORT
THAT IT AVERAGES OUT AT 1.2 TIMES FASTER THAN THE
NATIVE PYTHON ON MY MACHINE.
ACROSS THESE EIGHT BENCHMARKS, WHICH IS PRETTY
COOL.
OF COURSE, IF I COMPARE IT TO A NATIVE PYPY
INTERPRETER LIKE THE NATIVE PYPY IS GOING ON TO
BE FASTER THAN THE WEB, THIS ONE OUTLIER, WE'RE
OPERATING AT BETWEEN FIVE AND TEN TIMES SLOWER
THAN A NATIVE PYPY, WITH ALL OF ITS AMAZING KIND
OF YEARS OF WORK PUT INTO JITING, WHICH I THINK
FOR SOMETHING RUNNING IN THE WEB IS ACTUALLY
PRETTY AMAZING.
SO THAT'S THE GOOD.
IT COMES WITH A COST, HOWEVER.
SO THIS METRIC IS MEASURING THE SIZE OF THE
AMOUNT OF JAVASCRIPT THAT YOU NEED TO DOWNLOAD TO
RUN THIS THING.
AND I DON'T KNOW IF YOU CAN READ THAT ON THE
GRAPH HERE BUT AS A GENERAL RULE, WHEN YOU'RE
MEASURING THE SIZE OF YOUR JAVASCRIPT ASSETS IN
MEGABYTES, YOU'RE GOING TO HAVE A BAD TIME ON THE
WEB, RIGHT?
PART OF THE PROBLEM HERE IS THAT THIS IS, YOU
KNOW, ENSCRIPTIN IS DESIGNED FOR GAMES AND IN A
GAME, IT'S OKAY TO SHOW A LOADING GAME, I'M
LOADING A COUPLE OF GIG OF ASSETS, YOU DON'T CARE
ABOUT JAVASCRIPT.
BUT FOR SOMETHING LIKE THIS, YOU WOULD LIKE TO
LOAD IT FASTER.
THERE IS INTERESTING NOW WORK GOING ON INSIDE
ENSCRIPTIN THAT WILL MAKE THIS SMALLER AND I
THINK FOR DOING STUFF INSIDE PYPY.
SO THAT WILL BE PUSHING FORWARD ON THIS YEAR.
THIS IS MEASURING THE PERFORMANCE OF THAT
JAVASCRIPT I JUST SHOWED YOU, BASICALLY THE JS
MODULE, SO MEASURING THE OVERHEAD OF DOING LIKE
DOM MANIPULATION IN PYPY INSTEAD OF IN NATIVE
JAVASCRIPT AND EVEN IF I TAKE CHROME OUT OF THE
EQUATION, WE'RE TALKING HUNDREDS OF TIMES IS
SLOWER THAN DOG IT NENÊ ACTIVELY IN JAVASCRIPT,
WHICH IS NOT AWESOME.
I THINK, SOMEWHAT NAIVELY, THAT CAN CAN BE
DRAMATICALLY IMPROVED BY TEACHING THE PYPY JIT
ABOUT JAVASCRIPT, MORE ABOUT JAVASCRIPT, RIGHT?
BUT RIGHT NOW, IT'S KIND OF SLOW.
SO YOU CAN DO FUN DEMOS AND STUFF BUT IF YOU WERE
DOING LIKE SERIOUS DOM MANIPULATION, YOU'RE DOING
TO PAY A PERFORMANCE PENALTY.
SO IF I RETURN TO THE KIND OF QUESTION I HAD AT
THE START, ALL RIGHT, CAN WE HIT THIS MIDDLE
GROUND?
I WOULD LOVE TO BE ABLE TO STAND UP HERE AND SAY,
BAM, PYPY TO JS, RIGHT IN THE MIDDLE THERE,
TICKING ALL THREE BOXES.
YOU PROBABLY ARE NOT GOING TO BE CONVINCED AFTER
SEEING THOSE METRICS, RIGHT?
HONESTLY, IT PLACES CLOSER TO HERE.
IT'S A REALLY COMPATIBLE, PRETTY FAST PYTHON
ENVIRONMENT THAT RUNS IN THE WEB AND STARTING TO
PUSH INTO KIND OF BEING REALLY OF THE WEB.
BUT IF YOU TAKE THAT HIGH END AND TRY TO DO LIKE
SCRIPTING THE INTERACTIONS ON YOUR WEBSITE,
PROBABLY GOING TO BE A BIT SLOW RIGHT NOW.
THAT SAID, I THINK, YOU KNOW, THERE IS A WILL THE
OF GROUND FOR PUSHING -- A LOT OF GROUNDS FOR
PUSHING FURTHER AND FURTHER INTO THAT MIDDLE
GROUND SO BE REALLY INTERESTING TO SEE WHAT WE
CAN COME UP WITH OVER THE COMING YEAR.
OKAY.
SO, QUESTION YOU MAY HAVE ON YOUR MIND RIGHT NOW
IS, WHY?
GOOD, THANK YOU, AT LEAST SOMEONE DOES.
SO MY THOUGHTS ON THE MATTER ARE ALMOST ENTIRELY
SUMMED UP BY THIS SATURDAY MORNING BREAKFAST
CEREAL CARTOON.
WHEN SOMEONE ASKS YOU WHY, THEY KINDS OF EXPECT
YOU TO RESPONDS LIKE THIS, WHY IS THIS THING
IMPORTANT?
OH, IT HAS LOTS OF REALLY EXCELLENT APPLICATIONS
IN, LIKE, ENERGY AND SO FORTH.
I'M A LOT MORE LIKE THIS GUY, SO I CENSORED IT
FOR THE CONTENTS, BECAUSE ITS IT'S AWESOME, FUN,
I WANT TO DO AMAZING STUFF, RIGHTS?
THAT SAID, IT IS ALSO -- LIKE IT ALSO CAN BE
USEFUL.
SO AS I SAID, LIKE THE FIRST THING PEOPLE TEND TO
WANT TO DO IS SOMETHING LIKE THIS, RIGHT?
WRITE SCRIPT TEXT EQUALS PYTHON AND I WANT TO
REITERATE ONE THING I SAID EARLIER ON IN THE
TALK, IF YOU TRY TO DO THIS RIGHT NOW TODAY, YOUR
USERS WILL NOT WANT TO DOWNLOAD IN OUR OR FIVE
MEG OF ASSETS TO INTERACT.
THEY'RE GOING TO HAVE A BAD TIME.
THAT SAID, THE LOAD TIME OF YOUR SITE IS NOT
ALWAYS IN THE CRITICAL PATH SO, FOR EXAMPLE, NONE
OF YOU HAD TO SIT AROUND WAITING FOR MY SLIDES TO
LOADS, SO IF I SCROLL DOWN TO THE BOTTOM, I
SCRIPTED A BUNCH OF MY SLIDES LOGIC AS A SCRIPT
TYPE TEXT EQUALS PYTHON.
SIGHT WORKS, JUST BAD START-OUT BEHAVIOR SO BE
INTERESTING TO SEE HOW USEFUL WE CAN MAKE THAT.
FOLLOWING IN THAT THEME -- SORRY.
IF YOU WANT TO DO THAT TODAY, LIKE YOU SHOULD
PROBABLY CHECK OUT ONE OF THE ALTERNATE PROJECTS.
I HOPE TO BE COMPETITIVE WITH THEM SOMETIME THIS
YEAR, BUT SPECIFICALLY FOR SCRIPTING TAGS ON THE
WEB, PROBABLY CHECK ONE OF THESE OUT.
I DO WANT TO TRY TO DO SOME OTHER INTERESTING
STUFF, RIGHT?
PEOPLE REALLY LIKE THINGS LIKE PY 2 XE, WHERE YOU
CAN BUNDLE IT UP AND DISTRICT IT.
CAN WE USE SOMETHING LIKE THIS TO DEVELOP A PY TO
WEB?
PUT IT ON THE WEB AND IT RUNS WITHOUT ANY EXTRA
WORK, RIGHT?
CAN YOU THEN TAKE SOMETHING LIKE -- I CAN WIPE
OUT THE MANIFEST AND YOU HAVE AN INSTALLABLE
FIREFOX S APPLICATION, RIGHT, SO YOU CAN REACH
SOME -- SMARTPHONE MARKET WITH YOUR APP.
IF YOU RUN THAT THROUGH OUR AP K FACTORY, YOU CAN
TUNE THE FIREPOKES S AUTOPSY INTO AN ANDROID APP
AND REACH ONE OR TWO MORE PERCENT OF THE
SMARTPHONE WHYSER BASE.
THE OTHER -- USER BASE.
IT IS OTHER THING THAT PEOPLE HAVE GOING ON
THAT'S INTERESTING LIKE THE SCIENTIFIC COMMUNITY
DO A GREAT STUFF WITH PYTHON ON THE WEB WHERE THE
START-UP COSTS MAY NOT BE A DEAL-BREAKER SO CAN
WE GET MORE NEW ENGINEER -- NUMERIC STUFF INSIDE
PIPE AYE, CAN WE USE ENSCRIPTIN AND STITCH INTO
THIS INTO A FULL-BASED SCRIPTING PLATFORM, FUN
STUFF LIKE THAT.
I WANT TO CALL OUT EXPLICITLY THE POSSIBILITY OF
GETTING FREE STUFF.
SO YOU MAY HAVE NOTICED THAT I LEAVE THAT AS A
BAD -- NEVER MIND -- THAT I'VE BEEN RUNNING IN
PYTHON2.
PYTHON2, BECAUSE PYPY SUPPORTS PYTHON, 12 BY
DEFAULTS.
I WANT PYTHON 3 ON THE WEB.
I GO AND CHECK OUT THIS BRANCH OF THE REAPER AND
SUDDENLY, I'VE GOT PYTHON 3, ESSENTIALLY FOR FREE
RUNNING IN THE WEB.
IF PYTHON TURNS OUT TO BE NOT QUITE YOUR THING,
YOU CAN GO DO THIS REPO AND CHECK IT OUT.
ANYONE WHO DOESN'T RECOGNIZE THAT WEIRD PROMPT,
THIS IS A PROLOGUE ENGINE AND IT'S A PROPER ONE,
TOO.
IF I ASK IT TO SOLVE FOR A AND B, IT WILL TELL ME
AN ANSWER, THAT'S NOT GOOD ENOUGH, IT WILL TELL
ME OTHER ONE, SO ON.
IT RUNS IN THE WEB AND JITS TO JAVASCRIPT AT
RUNTIME AND I GOT ALL OF THAT FOR FREE.
THIS WORKED LITERALLY THE FIRST TIME I TRIED IT.
>> I CHECKED OUT THE REPO AND PUT IT ON THE WEB,
SO THE REASON I'M SO EXCITED ABOUT THIS APPROACH
IS I THINK IT REALLY OPENS UP IT IS POSSIBILITY
OF GETTING A LOT MORE STUFF ON TO THE WEB ONCE WE
PUT IN THE INITIAL WORK.
SO LET ME CONCLUDE BY SIMPLY SAYING, I WOULD LOVE
TO ENCOURAGE PEOPLE TO ADOPT THIS ATTITUDE OF
FOLLOWING BUGS AGAINST THE WEB.
WE REALLY SHOULDN'T SETTLE FOR THE WEB AS A
SECOND CLASS COMPUTING PLATFORM AND IF THIS TURNS
OUT TO BE A FAILED EXPERIMENT FOR WANT OF A
VARIETY OF REASONS, AND ALL I'VE MANAGED TO DO IS
IDENTIFY SOME BUGS IN THE WEB, THIS FAILED
BECAUSE THE WEB SUCKS AT X,  J, Z, THAT WILL BE A
SUCCESS FOR ME AND I WANT TO TRY AND INSPIRE
PEOPLE TO ASK MORE OF THE WEB AND HOPEFULLY WE
CAN START TREATING IT AS A FIRST-CLASS COMPUTING
PLATFORM RIGHT ACROSS THE SPECTRUM OF
ENGINEERING.
SO THANK YOU VERY MUCH.
HOPEFULLY I'VE LEFT SOME TIME FOR QUESTIONS.
[ Applause ]
01:04:47>> THANK YOU VERY MUCH, RYAN.
WE DO HAVE TIME FOR QUESTIONS AND I BELIEVE THERE
IS A MIC BACK HERE, SO IF YOU HAVE ANY QUESTIONS,
PLEASE COME ASK THEM.
>> HAVE YOU TRIED IT ON NODE?
YES.
*
>> YES.
YOU CAN ACTUALLY MPM INSTALL THIS THING, I
HAVEN'T PUBLISHED THE LATEST VERSION BUT YOU CAN,
AND IT'S EASIER THERE BECAUSE OF A VARIETIES OF
THINGS WITH THE WAY INSCRIPTING WORKS.
ONE OF THE THINGS I WOULD LIKE TO ACHIEVE IS
RUNNING A WYJS APP UNDER NODE, TO SEE IF IT'S
POSSIBLE, JUST FOR FUN.
>> AUDIENCE:  SO THERE'S BEEN TWO HISTORICAL
PROJECTS IN PYPY, ONE IS TO USE CLAIM AND...
[ Audio Indiscernible ]
AND THEY FAILED FOR WHATEVER REASON, AND THERE
WAS ALSO A JAVASCRIPT BACK IN THE DIOD.
DID YOU LOOK AT THOSE, WERE YOU ABLE TO REUSE
ANYTHING?
>> SO THE QUESTION WAS ESSENTIALLY THERE HAVE
BEEN LMVM BACK ENDS AND JAVA BACK ENDS FOR
JAVASCRIPT IN THE PAST AND DID I LOOK AT THEM AND
LEARN ANYTHING.
I DID BRIEFLY.
MY UNDERSTANDING IS THAT THESE SORT OF MORE OR
LESS PREDATE THE WORK THAT'S BEEN DONE IN
ENSCRIPTIN, RIGHT, SO THE ORIGINAL JAVASCRIPT
BACK IN PYPY WAS TRYING TO TARGETS MORE OR LESS
JAVASCRIPT, LIKE JAVASCRIPT OBJECTS AND SORT OF
MORE LIKE THE JAVASCRIPT THAT YOU WRITE BY HAND.
I THINK IT WAS EVENTUALLY ABANDONED AND RIPPED
OUT AND DECLARED TO BE A TERRIBLE IDEA AND I
AGREE BECAUSE PYTHON KNOT JAVASCRIPT.
THE REASON I SORT OF DIDN'T HESITATE TO START
THIS IS THAT THIS KIND OF SMJS AND ENSCRIPTIN,
THE WEB AS A 32-PIT CPU IS PRETTY NEW SO IT
BRINGS WITH IT A DIFFERENT SET OF CAPABILITIES
AND TRADE-OFFS THAT SEEM TO BE WORKING OUT OKAY
IN PRACTICE.
>> AUDIENCE: HI.
I'M CURIOUS, A FEW YEARS AGO, I WROTE JUST FOR
SEVERAL REASONS A -- OUT OF THE PYTHON
INTERPRETER, I WROTE A PYTHON PACKAGE I WAS ABLE
TO INTERACT WITH THE JAVASCRIPT CORE ENGINE AND
AT THAT POINT IT WAS WEB KIT JTTK WAS THE EASIEST
THING I COULD USE TO BRING UP A BROWSER THROUGH
PYTHON.
I WAS ABLE TO WRITE CODE THAT WAS DIRECTLY ABLE
TO INTERACT WITH JSON BEING AND THAT CAN INTERACT
WITH THE PYTHON CODES.
I'M WONDERING WHY DON'T WE EXPLORE OPTIONS OF
PUTTING A PYTHON INTERPRETER INTO THE BROWSER AND
USE TECHNOLOGIES THAT WOULD RUN THINGS EVEN
FASTER THAN JAVASCRIPT BECAUSE IT'S RUNNING
DIRECT PYTHON INTERPRETER IN THE BROWSER ITSELF,
WITHOUT THE -- AND ACTUALLY CAN INTERACT WITH ANY
JAVASCRIPT AT ALL THAT YOU PUT INTO THE WEB PAGE.
>> I WOULD LOVE TO SEE THAT HAPPEN.
THE DIFFICULTY IS NO ONE IS CAPABLE OF DOING THAT
THEMSELVES, RIGHT?
SO, I MEAN, GOOGLE AND CHROME ESSENTIALLY WANTED
TO DO THE SAME THING, THIS IS A BETTER LANGUAGE
THAN JAVASCRIPT, WE WANT TO SLIP THIS NATIVELY TO
THE WEB AND DESPITE KIND OF THE CLOUT THEY HAVE
WITH CHROME, THEY HAVEN'T BEEN ABLE TO DO THAT.
AND SO IT'S NOT KIND OF WITHIN ANY ONE WEB
VENDOR'S PALLOR TO TRY TO FORCE THIS FORWARD ON
THE WEB AND IF WE SHIP FIREFOX -- WE SHIP PYTHON
INSIDE FIREFOX, NOBODY'S GOING TO USE IT BECAUSE
IT'S NOT AVAILABLE IN CHROME, NOT AVAILABLE IN
INTERNET EXPLORER.
MY KIND OF SECRET HOPE IS THAT WE CAN SHIP THIS
KIND OF JAVASCRIPT SHENANIGANS AS A FALL-BACK.
SO IF A BROWSER WAS ABLE TO SHIP A NATIVE
IMPLEMENTATION OF A LANGUAGE, THEN YOU COULD USE
IT ABOUT THE IF THEY'RE NOT, THEN IT'S OKAY TO
FALL BACK TO THIS KIND OF COMPILED JAVASCRIPT
IMPLEMENTATION.
THAT'S ONE POTENTIAL WAY TO KIND OF BUILD UP
COLLABORATIVELY OUT OF, YOU KNOW, THE SITUATION
WE'RE IN RIGHT NOW, WHICH IS WHAT'S KIND OF
THREE-WAY MEXICAN STAND-OFF WHERE NO BROWSER
VENDOR WANTS TO -- OR EVERY BROWSER VENDOR WANTS
TO IMPROVE STUFF BUT IN DIFFERENT WAYS.
>> AUDIENCE:  SO ONE USE CASE THAT WE'VE USED
iPYTHON NOTEBOOK FOR IS HELPING PEOPLE LEARN
PYTHON FROM THE BEGINNING, INTRODUCING THEM TO
THE SYNTAX AND HOW IT MAKES THINGS FEEL WITHOUT
THE BURDEN OF SETTING UP THEIR SYSTEMS BUT
OBVIOUSLY PART OF THE CHALLENGE IS SOMEONE HAS TO
RUN THE iPYTHON NOTEBOOK SOMEWHERE AND THAT
SYSTEM IS BASICALLY INSECURE.
SO YOU ALLUDED TO THIS BUT I'M CURIOUS WHO'S
WORKING ON IT OR WHAT STATE IS IT IN, THE LOAD
TIME WILL BE LARGE BUT IN THIS CONTEXT, THAT'S
OKAY, THEY LOADED UP AT THE BEGINNING OF THE DAY
AND THEN -- I MEAN, EVEN JUST USING -- EVEN JUST
USING THE SORT OF EXAMPLE THAT YOU'RE SHOWING
WOULD BE GREAT BUT HOW IS THE WORK GOING,
PROGRESSING WITH COMBINING IT WITH iPYTHON
NOTEBOOK AND IS THAT ACTUALLY GOING TO HAPPEN
AND...
IS IT PRODUCTION-READY FOR THOSE SORT OF
PURPOSES?
OR EVEN YOUR OWN LIBRARY BEING READY FOR
PRODUCTION PURPOSES.
>> SO PART OF THE REASON I PUT THAT MENTION OF
iPYTHON ON MY SLIDES IS I WOULD LOVE TO FIND
SOMEONE HERE AT THE CONFERENCE WHO'S INTERESTED
IN THAT AND MAKE IT HAPPEN.
I'M NOT AWARE OF ANYONE WORKING ON THAT RIGHT
NOW, I JUST THINK IT WOULD BE COOL.
I DON'T THINK IT WOULD BE -- LIKE THE iPYTHON
STUFF IS REALLY WELL FACTORED, GOT EXCELLENT KIND
OF PROTOCOLS FOR DOING COMMUNICATION BETWEEN THE
FRONT END AND ENGINES AND SO FORTH, SO I THINK IT
WOULD PROBABLY COME TOGETHER QUITE NICELY BUT I
DON'T HAVE THE KIND OF KNOWLEDGE OR TIME TO BUILD
IT MYSELF.
I WOULD LOVE TO CONNECT WITH SOMEONE.
IF SOMEONE IS INTERESTED IN TRYING TO PLUG THIS
INTO iPYTHON NOTEBOOK AND SO FORTH, LET'S
CONNECT SOMEHOW AT THIS CONFERENCE BECAUSE I
THINK IT WOULD BE GREAT.
>> AGAIN, RYAN, LET'S GIVE RYAN A ROUND OF
APPLAUSE.
>> THANK YOU.
[ Applause ]
[ END OF SESSION ]
